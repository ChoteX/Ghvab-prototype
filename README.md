# Ghvab Textbook â€” Content & Exercises Guide

This project renders bilingual textbook content and companion exercises from JSON sources into interactive HTML pages. The repo contains:

- `part1.html` / `part1_english.html` â€” Chapter I content in Georgian and English.
- `exercises/index.html` â€” the standalone exercises hub for Parts I & II.
- JSON payloads under `content-*.json` and `exercises/*.json`.
- Utility scripts in `scripts/` for generating those JSON artifacts.

The notes below explain how the pieces fit together, how to regenerate JSON from the LaTeX sources, and how to safely edit or extend the interactive quizzes.

---

## 1. Content Pipeline Overview

### Step 1 â€” Source Authoring (LaTeX)
- Chapter narratives and exercises originate in the LaTeX files under `latex files/`.
  - `page1_georgian.tex` â€” master text for Part I (used to seed `content-ka.json`).
  - `par1_problems.tex`, `par2_problems.tex` â€” dedicated exercise/problem sets.
- Edits to these `.tex` files are preserved as the â€œsingle source of truth.â€

### Step 2 â€” JSON Generation
- Node scripts convert the LaTeX fragments into structured JSON:
  - `scripts/extract-content.js` (used earlier for chapter content).
  - `scripts/exercises/build-problems.js` (current generator for exercises).
- Running `node scripts/exercises/build-problems.js` produces:
  - `exercises/par1.json` â€” Part I exercise list + quiz data.
  - `exercises/par2.json` â€” Part II exercise list + quiz gleaned from the LaTeX sections.
- Generated JSON is pretty-printed for manual inspection or quick tweaks.

### Step 3 â€” HTML Rendering
- `part1.html` (Georgian) and `part1_english.html` (English) fetch `content-ka.json` / `content-en.json`, then render:
  - Section headings, text blocks, KaTeX math, and the autogenerated Table of Contents.
  - Language toggle logic reuses cached JSON to avoid repeated fetches.
- `exercises/index.html` loads the paragraph JSON files (`exercises/par1.json`, `exercises/par2.json`), builds the exercise lists, and enables interactive quizzes with the same KaTeX rendering and grading engine.

The graphic below summarizes the pipeline:

```
[LaTeX sources] --> node scripts/extract-content.js  --> content-*.json  --> part1*.html
[LaTeX exercises] --> node scripts/exercises/build-problems.js --> exercises/par*.json --> exercises/index.html
```

---

## 2. Generating / Refreshing Exercise JSON

1. **Install dependencies** (only needed once):
   ```bash
   npm install
   ```
2. **Run the generator** after editing any exercise LaTeX:
   ```bash
   node scripts/exercises/build-problems.js
   ```
3. **Verify output**:
   - `exercises/par1.json` and `exercises/par2.json` should update with the new content.
   - Open `exercises/index.html` in the browser and switch between â€œáƒœáƒáƒ¬áƒ˜áƒšáƒ˜ Iâ€ and â€œáƒœáƒáƒ¬áƒ˜áƒšáƒ˜ IIâ€ to confirm rendering.

> Tip: the script auto-parses `\section*{...}` and `\subsection*{...}` blocks. Ensure each subsection contains consistent `\begin{enumerate}` / `\item` structure so the conversion yields clean ordered lists.

---

## 3. Editing Content Safely

### 3.1 Editing Exercise Text
1. Modify the relevant LaTeX file (e.g., `latex files/par2_problems.tex`).
2. Keep the structure tidy:
   - Use `\section*` or `\subsection*` for new headings.
   - Wrap lists in `\begin{enumerate}[...] ... \end{enumerate}`.
   - Inline math should stay inside `$...$` so KaTeX can render it.
3. Re-run `node scripts/exercises/build-problems.js`.
4. Refresh the browser page to confirm layout and math rendering.

### 3.2 Editing JSON Directly (Quick Fix)
If you need a small adjustment without regenerating from LaTeX:
1. Open the JSON file (`exercises/par1.json` or `exercises/par2.json`).
2. Edit the text inside the `"lines"` arrays (for ordered lists) or `"text"` field (for paragraphs).
3. Save, reload the browserâ€”no build step required.

> Note: If you manually edit JSON, your changes will be overwritten the next time the generator runs. Prefer adjusting the LaTeX source when feasible.

---

## 4. Managing Quizzes & Answers

### 4.1 JSON Structure of a Quiz
Each quiz section in `exercises/par*.json` has the structure:
```json
{
  "title": "...",
  "type": "quiz",
  "quiz": {
    "questions": [
      {
        "id": "q1",
        "number": "1.",
        "prompt": "Question text",
        "options": [
          { "value": "a", "label": "Option A" },
          { "value": "b", "label": "Option B" }
        ]
      }
    ],
    "answerKey": {
      "q1": {
        "correct": "b",
        "explanation": "Why option B is correct.",
        "scored": true
      }
    }
  }
}
```

- `value` must match the key used in `answerKey`.
- `correct: null` marks a question as informational (no scoring).
- `scored: true` increments the quiz score; set to `false` for non-graded items.
- `explanation` is displayed after the learner clicks â€œáƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒâ€.

### 4.2 Adding a New Quiz Question
1. Edit the appropriate JSON (or update the generator script/LaTeX to produce it).
2. Append a new object to `"questions"` with a unique `"id"` (e.g., `"p2q6"`).
3. Add an entry under `"answerKey"` using the same ID.
4. If using the generator:
   - Update the relevant part of `scripts/exercises/build-problems.js` (`makePar1Data()` or `makePar2Quiz()`).
   - Re-run the script to regenerate the JSON.

### 4.3 Changing the Correct Answer / Explanation
1. Locate the question entry in `answerKey`.
2. Update `"correct"` to the matching option value (`"a"`, `"b"`, etc.).
3. Edit `"explanation"` to reflect the new rationale.
4. Save file and refresh the exercises page.

---

## 5. Browser Testing Checklist

After updates, run through the following:

1. **Exercises page** (`exercises/index.html`)
   - Ensure navigation buttons (â€œáƒœáƒáƒ¬áƒ˜áƒšáƒ˜ Iâ€, â€œáƒœáƒáƒ¬áƒ˜áƒšáƒ˜ IIâ€) switch sections smoothly.
   - Verify headings, lists, and math expressions render correctly.
   - Run the quizzes: select answers, click â€œáƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒâ€, and check feedback.
2. **Chapter pages**
   - Open `part1.html` and `part1_english.html`.
   - Confirm the new â€œáƒ¡áƒáƒ•áƒáƒ áƒ¯áƒ˜áƒ¨áƒáƒ”áƒ‘áƒ˜ / Exercisesâ€ header link works.
   - If chapter content changed, make sure the TOC and math still render.

---

## 6. Project Structure Reference

```
â”œâ”€â”€ content-en.json / content-ka.json    # Chapter I content (HTML loader)
â”œâ”€â”€ exercises/
â”‚   â”œâ”€â”€ index.html                       # Exercises hub page
â”‚   â”œâ”€â”€ par1.json                        # Part I exercises + quiz (generated)
â”‚   â””â”€â”€ par2.json                        # Part II exercises + quiz (generated)
â”œâ”€â”€ latex files/
â”‚   â”œâ”€â”€ page1_georgian.tex               # Main chapter LaTeX source
â”‚   â”œâ”€â”€ par1_problems.tex                # Part I problems source
â”‚   â””â”€â”€ par2_problems.tex                # Part II problems source
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ extract-content.js               # (Legacy) chapter JSON generator
â”‚   â””â”€â”€ exercises/
â”‚       â””â”€â”€ build-problems.js            # Exercises JSON pipeline
â”œâ”€â”€ part1.html / part1_english.html      # Chapter I pages
â””â”€â”€ styles.css / katex/                  # Shared styling & math rendering
```

---

## 7. Tips for Future Enhancements

- If you add a new chapter or paragraph, copy `scripts/exercises/build-problems.js` patterns for building JSON (meta, sections, quizzes).
- Keep `option.value` short (single letters) to avoid cluttering the radio buttons.
- When adding math-heavy questions, confirm KaTeX renders after the â€œáƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒâ€ actionâ€”`renderMathInElement` is re-run after quiz evaluation for that purpose.
- For large exercise lists, consider grouping related items in separate subsections to keep the page manageable.

---

Happy editing! Reach out in comments or PRs if you need to evolve the generator or extend the interactive components further. ğŸ‘
